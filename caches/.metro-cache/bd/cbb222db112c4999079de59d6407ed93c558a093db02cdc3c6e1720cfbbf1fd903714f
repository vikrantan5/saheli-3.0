{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"]}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"]}},{"name":"firebase/storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":82,"index":82}}],"key":"gnxuAFqfHppifCx3rWRGYoeEoGk=","exportNames":["*"]}},{"name":"../config/firebaseConfig","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":84},"end":{"line":2,"column":51,"index":135}}],"key":"c2ktbavwtrva9DBC5I1TB1Fz260=","exportNames":["*"]}},{"name":"react-native","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":137},"end":{"line":3,"column":40,"index":177}}],"key":"KyzuX10g6ixS9UfynhmjlvCIG3g=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.uploadSOSImage = exports.generateSecureLink = exports.deleteSOSImage = void 0;\n  var _asyncToGenerator2 = _interopRequireDefault(require(_dependencyMap[1], \"@babel/runtime/helpers/asyncToGenerator\"));\n  var _storage = require(_dependencyMap[2], \"firebase/storage\");\n  var _firebaseConfig = require(_dependencyMap[3], \"../config/firebaseConfig\");\n  var _reactNative = require(_dependencyMap[4], \"react-native\");\n  /**\r\n   * Upload image to Firebase Storage\r\n   * @param {string} uri - Local image URI\r\n   * @param {Object} metadata - Image metadata (timestamp, GPS, device info)\r\n   * @param {string} userId - User ID for organizing storage\r\n   * @returns {Promise<string>} Download URL of uploaded image\r\n   */\n  var uploadSOSImage = exports.uploadSOSImage = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator2.default)(function* (uri, metadata, userId) {\n      try {\n        if (!uri) {\n          throw new Error('No image URI provided');\n        }\n\n        // Generate unique filename\n        var timestamp = Date.now();\n        var filename = `sos_images/${userId}/${timestamp}.jpg`;\n        var storageRef = (0, _storage.ref)(_firebaseConfig.storage, filename);\n        var downloadURL;\n        if (_reactNative.Platform.OS === 'web') {\n          // For web, fetch the blob\n          var response = yield fetch(uri);\n          var blob = yield response.blob();\n\n          // Upload blob with metadata\n          yield (0, _storage.uploadBytes)(storageRef, blob, {\n            contentType: 'image/jpeg',\n            customMetadata: {\n              ...metadata,\n              timestamp: metadata.timestamp || new Date().toISOString()\n            }\n          });\n          downloadURL = yield (0, _storage.getDownloadURL)(storageRef);\n        } else {\n          // For React Native (iOS/Android)\n          var _response = yield fetch(uri);\n          var _blob = yield _response.blob();\n\n          // Upload blob with metadata\n          yield (0, _storage.uploadBytes)(storageRef, _blob, {\n            contentType: 'image/jpeg',\n            customMetadata: {\n              ...metadata,\n              timestamp: metadata.timestamp || new Date().toISOString(),\n              gps: JSON.stringify(metadata.gps || {})\n            }\n          });\n          downloadURL = yield (0, _storage.getDownloadURL)(storageRef);\n        }\n        console.log('✅ Image uploaded successfully:', downloadURL);\n        return downloadURL;\n      } catch (error) {\n        console.error('❌ Error uploading image to Firebase Storage:', error);\n        throw new Error(`Failed to upload image: ${error.message}`);\n      }\n    });\n    return function uploadSOSImage(_x, _x2, _x3) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  /**\r\n   * Generate secure, shareable link with expiry\r\n   * @param {string} downloadURL - Firebase Storage download URL\r\n   * @param {Object} metadata - Additional metadata to include\r\n   * @returns {string} Formatted shareable link\r\n   */\n  var generateSecureLink = (downloadURL, metadata) => {\n    // For now, return the direct download URL\n    // In production, you might want to use Firebase Dynamic Links\n    return downloadURL;\n  };\n\n  /**\r\n   * Delete SOS image from storage\r\n   * @param {string} imageUrl - Image URL to delete\r\n   * @returns {Promise<void>}\r\n   */\n  exports.generateSecureLink = generateSecureLink;\n  var deleteSOSImage = exports.deleteSOSImage = /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator2.default)(function* (imageUrl) {\n      try {\n        // Extract path from URL\n        var urlParts = imageUrl.split('/o/');\n        if (urlParts.length < 2) {\n          throw new Error('Invalid image URL');\n        }\n        var pathWithQuery = urlParts[1].split('?')[0];\n        var imagePath = decodeURIComponent(pathWithQuery);\n        var imageRef = (0, _storage.ref)(_firebaseConfig.storage, imagePath);\n        yield deleteObject(imageRef);\n        console.log('✅ Image deleted successfully');\n      } catch (error) {\n        console.error('❌ Error deleting image:', error);\n        throw error;\n      }\n    });\n    return function deleteSOSImage(_x4) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n});","lineCount":112,"map":[[8,2,1,0],[8,6,1,0,"_storage"],[8,14,1,0],[8,17,1,0,"require"],[8,24,1,0],[8,25,1,0,"_dependencyMap"],[8,39,1,0],[9,2,2,0],[9,6,2,0,"_firebaseConfig"],[9,21,2,0],[9,24,2,0,"require"],[9,31,2,0],[9,32,2,0,"_dependencyMap"],[9,46,2,0],[10,2,3,0],[10,6,3,0,"_reactNative"],[10,18,3,0],[10,21,3,0,"require"],[10,28,3,0],[10,29,3,0,"_dependencyMap"],[10,43,3,0],[11,2,5,0],[12,0,6,0],[13,0,7,0],[14,0,8,0],[15,0,9,0],[16,0,10,0],[17,0,11,0],[18,2,12,7],[18,6,12,13,"uploadSOSImage"],[18,20,12,27],[18,23,12,27,"exports"],[18,30,12,27],[18,31,12,27,"uploadSOSImage"],[18,45,12,27],[19,4,12,27],[19,8,12,27,"_ref"],[19,12,12,27],[19,19,12,27,"_asyncToGenerator2"],[19,37,12,27],[19,38,12,27,"default"],[19,45,12,27],[19,47,12,30],[19,58,12,37,"uri"],[19,61,12,40],[19,63,12,42,"metadata"],[19,71,12,50],[19,73,12,52,"userId"],[19,79,12,58],[19,81,12,63],[20,6,13,2],[20,10,13,6],[21,8,14,4],[21,12,14,8],[21,13,14,9,"uri"],[21,16,14,12],[21,18,14,14],[22,10,15,6],[22,16,15,12],[22,20,15,16,"Error"],[22,25,15,21],[22,26,15,22],[22,49,15,45],[22,50,15,46],[23,8,16,4],[25,8,18,4],[26,8,19,4],[26,12,19,10,"timestamp"],[26,21,19,19],[26,24,19,22,"Date"],[26,28,19,26],[26,29,19,27,"now"],[26,32,19,30],[26,33,19,31],[26,34,19,32],[27,8,20,4],[27,12,20,10,"filename"],[27,20,20,18],[27,23,20,21],[27,37,20,35,"userId"],[27,43,20,41],[27,47,20,45,"timestamp"],[27,56,20,54],[27,62,20,60],[28,8,21,4],[28,12,21,10,"storageRef"],[28,22,21,20],[28,25,21,23],[28,29,21,23,"ref"],[28,41,21,26],[28,43,21,27,"storage"],[28,66,21,34],[28,68,21,36,"filename"],[28,76,21,44],[28,77,21,45],[29,8,23,4],[29,12,23,8,"downloadURL"],[29,23,23,19],[30,8,25,4],[30,12,25,8,"Platform"],[30,33,25,16],[30,34,25,17,"OS"],[30,36,25,19],[30,41,25,24],[30,46,25,29],[30,48,25,31],[31,10,26,6],[32,10,27,6],[32,14,27,12,"response"],[32,22,27,20],[32,31,27,29,"fetch"],[32,36,27,34],[32,37,27,35,"uri"],[32,40,27,38],[32,41,27,39],[33,10,28,6],[33,14,28,12,"blob"],[33,18,28,16],[33,27,28,25,"response"],[33,35,28,33],[33,36,28,34,"blob"],[33,40,28,38],[33,41,28,39],[33,42,28,40],[35,10,30,6],[36,10,31,6],[36,16,31,12],[36,20,31,12,"uploadBytes"],[36,40,31,23],[36,42,31,24,"storageRef"],[36,52,31,34],[36,54,31,36,"blob"],[36,58,31,40],[36,60,31,42],[37,12,32,8,"contentType"],[37,23,32,19],[37,25,32,21],[37,37,32,33],[38,12,33,8,"customMetadata"],[38,26,33,22],[38,28,33,24],[39,14,34,10],[39,17,34,13,"metadata"],[39,25,34,21],[40,14,35,10,"timestamp"],[40,23,35,19],[40,25,35,21,"metadata"],[40,33,35,29],[40,34,35,30,"timestamp"],[40,43,35,39],[40,47,35,43],[40,51,35,47,"Date"],[40,55,35,51],[40,56,35,52],[40,57,35,53],[40,58,35,54,"toISOString"],[40,69,35,65],[40,70,35,66],[41,12,36,8],[42,10,37,6],[42,11,37,7],[42,12,37,8],[43,10,39,6,"downloadURL"],[43,21,39,17],[43,30,39,26],[43,34,39,26,"getDownloadURL"],[43,57,39,40],[43,59,39,41,"storageRef"],[43,69,39,51],[43,70,39,52],[44,8,40,4],[44,9,40,5],[44,15,40,11],[45,10,41,6],[46,10,42,6],[46,14,42,12,"response"],[46,23,42,20],[46,32,42,29,"fetch"],[46,37,42,34],[46,38,42,35,"uri"],[46,41,42,38],[46,42,42,39],[47,10,43,6],[47,14,43,12,"blob"],[47,19,43,16],[47,28,43,25,"response"],[47,37,43,33],[47,38,43,34,"blob"],[47,42,43,38],[47,43,43,39],[47,44,43,40],[49,10,45,6],[50,10,46,6],[50,16,46,12],[50,20,46,12,"uploadBytes"],[50,40,46,23],[50,42,46,24,"storageRef"],[50,52,46,34],[50,54,46,36,"blob"],[50,59,46,40],[50,61,46,42],[51,12,47,8,"contentType"],[51,23,47,19],[51,25,47,21],[51,37,47,33],[52,12,48,8,"customMetadata"],[52,26,48,22],[52,28,48,24],[53,14,49,10],[53,17,49,13,"metadata"],[53,25,49,21],[54,14,50,10,"timestamp"],[54,23,50,19],[54,25,50,21,"metadata"],[54,33,50,29],[54,34,50,30,"timestamp"],[54,43,50,39],[54,47,50,43],[54,51,50,47,"Date"],[54,55,50,51],[54,56,50,52],[54,57,50,53],[54,58,50,54,"toISOString"],[54,69,50,65],[54,70,50,66],[54,71,50,67],[55,14,51,10,"gps"],[55,17,51,13],[55,19,51,15,"JSON"],[55,23,51,19],[55,24,51,20,"stringify"],[55,33,51,29],[55,34,51,30,"metadata"],[55,42,51,38],[55,43,51,39,"gps"],[55,46,51,42],[55,50,51,46],[55,51,51,47],[55,52,51,48],[56,12,52,8],[57,10,53,6],[57,11,53,7],[57,12,53,8],[58,10,55,6,"downloadURL"],[58,21,55,17],[58,30,55,26],[58,34,55,26,"getDownloadURL"],[58,57,55,40],[58,59,55,41,"storageRef"],[58,69,55,51],[58,70,55,52],[59,8,56,4],[60,8,58,4,"console"],[60,15,58,11],[60,16,58,12,"log"],[60,19,58,15],[60,20,58,16],[60,52,58,48],[60,54,58,50,"downloadURL"],[60,65,58,61],[60,66,58,62],[61,8,59,4],[61,15,59,11,"downloadURL"],[61,26,59,22],[62,6,60,2],[62,7,60,3],[62,8,60,4],[62,15,60,11,"error"],[62,20,60,16],[62,22,60,18],[63,8,61,4,"console"],[63,15,61,11],[63,16,61,12,"error"],[63,21,61,17],[63,22,61,18],[63,68,61,64],[63,70,61,66,"error"],[63,75,61,71],[63,76,61,72],[64,8,62,4],[64,14,62,10],[64,18,62,14,"Error"],[64,23,62,19],[64,24,62,20],[64,51,62,47,"error"],[64,56,62,52],[64,57,62,53,"message"],[64,64,62,60],[64,66,62,62],[64,67,62,63],[65,6,63,2],[66,4,64,0],[66,5,64,1],[67,4,64,1],[67,20,12,13,"uploadSOSImage"],[67,34,12,27,"uploadSOSImage"],[67,35,12,27,"_x"],[67,37,12,27],[67,39,12,27,"_x2"],[67,42,12,27],[67,44,12,27,"_x3"],[67,47,12,27],[68,6,12,27],[68,13,12,27,"_ref"],[68,17,12,27],[68,18,12,27,"apply"],[68,23,12,27],[68,30,12,27,"arguments"],[68,39,12,27],[69,4,12,27],[70,2,12,27],[70,5,64,1],[72,2,66,0],[73,0,67,0],[74,0,68,0],[75,0,69,0],[76,0,70,0],[77,0,71,0],[78,2,72,7],[78,6,72,13,"generateSecureLink"],[78,24,72,31],[78,27,72,34,"generateSecureLink"],[78,28,72,35,"downloadURL"],[78,39,72,46],[78,41,72,48,"metadata"],[78,49,72,56],[78,54,72,61],[79,4,73,2],[80,4,74,2],[81,4,75,2],[81,11,75,9,"downloadURL"],[81,22,75,20],[82,2,76,0],[82,3,76,1],[84,2,78,0],[85,0,79,0],[86,0,80,0],[87,0,81,0],[88,0,82,0],[89,2,78,0,"exports"],[89,9,78,0],[89,10,78,0,"generateSecureLink"],[89,28,78,0],[89,31,78,0,"generateSecureLink"],[89,49,78,0],[90,2,83,7],[90,6,83,13,"deleteSOSImage"],[90,20,83,27],[90,23,83,27,"exports"],[90,30,83,27],[90,31,83,27,"deleteSOSImage"],[90,45,83,27],[91,4,83,27],[91,8,83,27,"_ref2"],[91,13,83,27],[91,20,83,27,"_asyncToGenerator2"],[91,38,83,27],[91,39,83,27,"default"],[91,46,83,27],[91,48,83,30],[91,59,83,37,"imageUrl"],[91,67,83,45],[91,69,83,50],[92,6,84,2],[92,10,84,6],[93,8,85,4],[94,8,86,4],[94,12,86,10,"urlParts"],[94,20,86,18],[94,23,86,21,"imageUrl"],[94,31,86,29],[94,32,86,30,"split"],[94,37,86,35],[94,38,86,36],[94,43,86,41],[94,44,86,42],[95,8,87,4],[95,12,87,8,"urlParts"],[95,20,87,16],[95,21,87,17,"length"],[95,27,87,23],[95,30,87,26],[95,31,87,27],[95,33,87,29],[96,10,88,6],[96,16,88,12],[96,20,88,16,"Error"],[96,25,88,21],[96,26,88,22],[96,45,88,41],[96,46,88,42],[97,8,89,4],[98,8,91,4],[98,12,91,10,"pathWithQuery"],[98,25,91,23],[98,28,91,26,"urlParts"],[98,36,91,34],[98,37,91,35],[98,38,91,36],[98,39,91,37],[98,40,91,38,"split"],[98,45,91,43],[98,46,91,44],[98,49,91,47],[98,50,91,48],[98,51,91,49],[98,52,91,50],[98,53,91,51],[99,8,92,4],[99,12,92,10,"imagePath"],[99,21,92,19],[99,24,92,22,"decodeURIComponent"],[99,42,92,40],[99,43,92,41,"pathWithQuery"],[99,56,92,54],[99,57,92,55],[100,8,94,4],[100,12,94,10,"imageRef"],[100,20,94,18],[100,23,94,21],[100,27,94,21,"ref"],[100,39,94,24],[100,41,94,25,"storage"],[100,64,94,32],[100,66,94,34,"imagePath"],[100,75,94,43],[100,76,94,44],[101,8,95,4],[101,14,95,10,"deleteObject"],[101,26,95,22],[101,27,95,23,"imageRef"],[101,35,95,31],[101,36,95,32],[102,8,97,4,"console"],[102,15,97,11],[102,16,97,12,"log"],[102,19,97,15],[102,20,97,16],[102,50,97,46],[102,51,97,47],[103,6,98,2],[103,7,98,3],[103,8,98,4],[103,15,98,11,"error"],[103,20,98,16],[103,22,98,18],[104,8,99,4,"console"],[104,15,99,11],[104,16,99,12,"error"],[104,21,99,17],[104,22,99,18],[104,47,99,43],[104,49,99,45,"error"],[104,54,99,50],[104,55,99,51],[105,8,100,4],[105,14,100,10,"error"],[105,19,100,15],[106,6,101,2],[107,4,102,0],[107,5,102,1],[108,4,102,1],[108,20,83,13,"deleteSOSImage"],[108,34,83,27,"deleteSOSImage"],[108,35,83,27,"_x4"],[108,38,83,27],[109,6,83,27],[109,13,83,27,"_ref2"],[109,18,83,27],[109,19,83,27,"apply"],[109,24,83,27],[109,31,83,27,"arguments"],[109,40,83,27],[110,4,83,27],[111,2,83,27],[111,5,102,1],[112,0,102,2],[112,3]],"functionMap":{"names":["<global>","uploadSOSImage","generateSecureLink","deleteSOSImage"],"mappings":"AAA;8BCW;CDoD;kCEQ;CFI;8BGO;CHmB"}},"type":"js/module"}]}